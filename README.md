# Техническое задание: Система ведения ежедневных отчетов

## 1. Общие сведения

### 1.1 Назначение системы

Система предназначена для контроля выполнения ежедневных задач в медицинском отделении (лаборатории). Позволяет врачам и сотрудникам отмечать выполнение обязательных процедур по окончании рабочей смены, ведя учет состояния помещений, расходных материалов и требований безопасности.

### 1.2 Область применения

- Контроль выполнения процедур закрытия смены в медицинских лабораториях
- Ведение отчетности по состоянию помещений и оборудования
- Обеспечение соблюдения требований безопасности и санитарных норм
- Учет расходных материалов

### 1.3 Глоссарий

- **Отчет о смене** - ежедневная форма контроля выполнения процедур закрытия смены
- **Блок задач** - группа связанных задач (помещения, материалы, безопасность)
- **Задача** - конкретная процедура с возможностью отметки статуса выполнения
- **Статус задачи** - состояние выполнения (выполнено/не выполнено/не отмечено)
- **Описание** - примечание к задаче от исполнителя
- **Конфигурация** - настройки системы (врачи и структура задач)
- **Исторические данные** - отчеты за прошедшие даты

## 2. Функциональные требования

### 2.1 Основные пользовательские сценарии

#### 2.1.1 Заполнение отчета о смене

**Описание:** Врач заполняет отчет о выполнении процедур закрытия смены
**Предусловие:** Система запущена, врачи и задачи настроены в конфигурации
**Основной поток:**

1. Врач выбирает свое ФИО из выпадающего списка
2. Система отображает форму с блоками задач на текущую дату
3. Врач просматривает задачи, сгруппированные по блокам:
   - "ПОМЕЩЕНИЯ ОТДЕЛЕНИЯ ПОСЛЕ ОКОНЧАНИЯ СМЕНЫ"
   - "РАСХОДНЫЕ МАТЕРИАЛЫ"
   - "ТРЕБОВАНИЯ БЕЗОПАСНОСТИ"
4. Для каждой задачи врач выбирает статус:
   - Выполнено (complete: true)
   - Не выполнено (notComplete: true)
   - Оставляет без отметки (оба значения false)
5. Врач добавляет описание/примечания к задачам (опционально)
6. Система автоматически сохраняет данные каждые 5 секунд
7. При закрытии приложения данные сохраняются принудительно

**Результат:** Отчет о смене сохранен в системе

#### 2.1.2 Просмотр исторических данных

**Описание:** Врач просматривает отчеты за прошедшие даты
**Основной поток:**

1. Врач выбирает прошедшую дату (будущие даты недоступны)
2. Врач выбирает свое ФИО
3. Если данные существуют - отображается форма в режиме "только чтение" с заполненными статусами задач и описаниями
4. Если данных нет - отображается пустая форма для заполнения
5. В режиме "только чтение" доступна кнопка "Редактировать"
6. При нажатии "Редактировать" форма становится доступной для изменения статусов и описаний

#### 2.1.3 Управление конфигурацией

**Описание:** Администратор настраивает врачей и структуру задач
**Основной поток:**

1. Открытие интерфейса редактирования конфигурации
2. Редактирование списка врачей (добавление, удаление, изменение ФИО)
3. Редактирование блоков задач:
   - Добавление/удаление блоков
   - Изменение названий блоков
   - Управление задачами внутри блоков (добавление, удаление, редактирование)
   - Изменение нумерации и порядка задач
4. Сохранение изменений
5. Применение новой конфигурации

**Особенности:**

- Изменения в конфигурации влияют на все новые отчеты
- Исторические данные сохраняют структуру на момент их создания

### 2.2 Детальные функциональные требования

#### FR-1: Выбор врача

- Выпадающий список с ФИО всех врачей из конфигурации
- Список берется из поля `meta.doctors[].name`
- Обязательный выбор для доступа к форме отчета

#### FR-2: Заполнение отчета о смене

- Отображение задач в виде сгруппированных блоков
- Каждый блок содержит:
  - Заголовок блока (`label`)
  - Список пронумерованных задач (`tasks`)
- Для каждой задачи отображается:
  - Номер задачи (`number`)
  - Название задачи (`label`)
  - Статус выполнения - радиокнопки или чекбоксы:
    - "Выполнено" (`status.complete`)
    - "Не выполнено" (`status.notComplete`)
    - "Не отмечено" (оба значения false)
  - Поле описания (`description`) - текстовое поле без ограничений
- Кнопка "Выбрать все" - отмечает все задачи как выполненные
- Кнопка "Очистить форму" - сбрасывает все статусы и очищает описания
- Все поля заполнения опциональны

#### FR-3: Автоматическое сохранение

- Сохранение каждые 5 секунд при наличии изменений
- Принудительное сохранение при закрытии приложения любым способом
- Восстановление данных при аварийном закрытии
- Данные сохраняются в структуре `days[date][doctorName]`

#### FR-4: Работа с датами

- Календарь для выбора даты
- Блокировка будущих дат
- По умолчанию выбрана текущая дата

#### FR-5: Режимы просмотра и редактирования

- Исторические данные открываются в режиме "только чтение"
- Кнопка "Редактировать" для перехода в режим изменения
- Визуальное различие между режимами

#### FR-6: Печать отчета

- Функция печати отчета за выбранный день
- Корректное форматирование для печати
- Включение всех заполненных данных

#### FR-7: Редактирование конфигурации

- Отдельный интерфейс для редактирования конфигурации
- Управление списком врачей:
  - Добавление нового врача (ввод ФИО)
  - Редактирование существующих записей
  - Удаление врачей (с проверкой на наличие исторических данных)
- Управление блоками задач:
  - Создание новых блоков с названием
  - Редактирование названий блоков
  - Удаление блоков
  - Изменение порядка блоков
- Управление задачами внутри блоков:
  - Добавление новых задач с автонумерацией
  - Редактирование текста задач
  - Удаление задач
  - Изменение порядка и перенумерация
- Валидация корректности структуры конфигурации
- Предупреждения при критических изменениях

## 3. Нефункциональные требования

### 3.1 Требования к производительности

- Время загрузки приложения: не более 3 секунд
- Время сохранения данных: не более 1 секунды
- Поддержка работы с историческими данными за любой период

### 3.2 Требования к надежности

- Автоматическое восстановление после сбоев
- Резервирование данных при сохранении
- Валидация целостности конфигурационного файла

### 3.3 Требования к совместимости

- Поддержка Windows 7 32-bit и выше
- Работа без подключения к интернету
- Портативность установки

### 3.4 Требования к пользовательскому интерфейсу

- Интуитивно понятный интерфейс
- Быстрый доступ к основным функциям
- Четкое визуальное разделение режимов работы

## 4. Структура данных

### 4.1 Конфигурационный файл (config.json)

```json
{
  "days": {
    ["yyyy-mm-dd"]: {
      "meta": {...},
      ["doctorName"]: {
        "blocks": [...],

      },
      ["doctorName"]: {
        "blocks": [...],
      }
      ...
    },
    ["yyyy-mm-dd"]: {
      "meta": {...},
      ["doctorName"]: {
        "blocks": [...],
      }
      ...
    }
    ...
  },
  "meta": {
    "blocks": [
      {
        "label": "ПОМЕЩЕНИЯ ОТДЕЛЕНИЯ ПОСЛЕ ОКОНЧАНИЯ СМЕНЫ",
        "tasks": [
          {
            "number": 1,
            "label": "БОКС ПРИЕМА ОБРАЗЦОВ",
            "status": {
              "complete": false,
              "notComplete": false
            },
            "description": ""
          }
          {...}
        ]
      },
      {
        "label": "РАСХОДНЫЕ МАТЕРИАЛЫ",
        "tasks": [...]
      },
      {
        "label": "ТРЕБОВАНИЯ БЕЗОПАСНОСТИ",
        "tasks": [...]
      }
      {...}
    ],
    "doctors": [
      { "name": "Иванов Иван Иванович" },
      { "name": "Петров Петр Петрович" }
    ]
  }
}
```

### 4.2 Структура данных отчета

- **Дата**: строка в формате YYYY-MM-DD (например, "2025-10-23")
- **Врач**: строка (ФИО из списка doctors)
- **Блоки задач**: массив объектов block
  - **Название блока**: строка (label)
  - **Задачи**: массив объектов task
    - **Номер**: число (number)
    - **Название задачи**: строка (label)
    - **Статус**: объект с полями complete и notComplete (boolean)
    - **Описание**: строка (description)

## 5. Техническая реализация

### 5.1 Backend (Electron Main Process)

#### Технологический стек:

- Electron 22.3.27 (совместимость с Windows 7 32-bit)
- TypeScript
- electron-builder
- electron-vite

#### Модульная структура:

```
src/main/
├── index.ts          # Точка входа
├── api.ts            # IPC handlers для обработки событий от рендерера
├── service.ts        # Бизнес-логика приложения
├── config.ts         # Инициализация конфигурации по умолчанию
├── store.ts          # Обертка для хранилища данных
├── window.ts         # Управление главным окном
└── security.ts       # Настройки безопасности приложения
```

#### Ключевые модули:

**api.ts:**

- `getDoctorsMeta()` - получение глобального списка врачей из meta
- `setDoctorsMeta(doctors)` - сохранение глобального списка врачей в meta (Для редактора конфигурации)
- `getBlocksMeta()` - получение глобальных блоков задач из meta
- `setBlocksMeta(blocks)` - сохранение глобальных блоков задач в meta
- `getDoctorsDateMeta(date)` - получение списка врачей для конкретного дня из meta
- `setDoctorsDateMeta(date, doctors)` - сохранение списка врачей для конкретного дня в meta (Для редактора конфигурации)
- `getBlocksDateMeta(date)` - получение блоков задач для конкретного дня из meta
- `setBlocksDateMeta(date, blocks)` - сохранения блоков задач для конкретного дня в meta
- `getBlocksForDoctor(date, doctorName)` - получение блоков задач для конкретного доктора в выбранный день
- `setBlocksForDoctor(date, doctorName, blocks)` - сохранение отчета о смене
- `getMeta()` - получение полной конфигурации
- `setMeta(meta)` - обновление конфигурации
- `printReport(date, doctorName)` - печать отчета о смене
- `getCurrentDate()` - получение текущей даты с серверной части

**service.ts:**

- Валидация структуры блоков и задач
- Логика автосохранения отчетов
- Работа с датами в формате YYYY-MM-DD
- Форматирование данных для печати по блокам
- Миграция структуры данных при изменении конфигурации

### 5.2 Frontend (Electron Renderer Process)

#### Технологический стек:

- Vue 3.5.18 (Composition API, script setup)
- TypeScript
- Vite

#### Структура:

```
src/renderer/
├── index.html
├── main.ts          # Инициализация Vue приложения
├── App.vue          # Корневой компонент
├── components/
│   ├── ui/          # Базовые UI компоненты
│   ├── widgets/     # Составные компоненты
│   └── pages/       # Страницы приложения
├── security.ts      # Настройки безопасности рендерера
└── style.css        # Глобальные стили
```

#### Основные компоненты:

- `ReportForm.vue` - главная форма отчета о смене
- `ConfigEditor.vue` - редактор конфигурации
- `DoctorManager.vue` - управление списком врачей
- `BlockManager.vue` - управление блоками задач
- `PrintPreview.vue` - предпросмотр отчета для печати

## 6. Требования к развертыванию

### 6.1 CI/CD

- Автоматическая сборка при push в main ветку
- Автоматическое тестирование
- Создание релизов в GitHub с артефактами сборки
- Поддержка semantic versioning

### 6.2 Сборка и распространение

- Создание установщика для Windows
- Portable версия приложения
- Автоматическая подпись исполняемых файлов

## 7. Критерии приемки

### 7.1 Основные сценарии

- ✅ Пользователь может выбрать себя и заполнить отчет
- ✅ Данные сохраняются автоматически и при закрытии приложения
- ✅ Исторические данные отображаются в режиме "только чтение"
- ✅ Доступно редактирование исторических данных
- ✅ Будущие даты недоступны для выбора
- ✅ Работает функция "Выбрать все" и "Очистить форму"
- ✅ Конфигурация редактируется через отдельный интерфейс
- ✅ Отчет можно распечатать

### 7.2 Технические критерии

- ✅ Приложение работает на Windows 7 32-bit
- ✅ Модульная архитектура позволяет замену компонентов
- ✅ Настроен автоматический CI/CD
- ✅ Данные восстанавливаются после сбоя

## 8. Риски и ограничения

### 8.1 Технические риски

- Ограничения Electron 22.3.27 для поддержки Windows 7
- Производительность при большом количестве исторических данных

### 8.2 Пользовательские риски

- Случайное повреждение конфигурационного файла
- Потеря данных при аварийном завершении работы

### 8.3 Меры по митигации

- Регулярное создание резервных копий
- Валидация конфигурационного файла при загрузке
- Журналирование критических операций
